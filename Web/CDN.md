# CDN

标签（空格分隔）： CDN

---

CDN的全称是Content Delivery Network，即内容分发网络。

## 技术原理

　　CDN是一个经策略性部署的整体系统，包括分布式存储、负载均衡、网络请求的重定向和内容管理４个要件。

### 分布式存储

　　这点显而易见，CDN网络将存储资源分布到各个地理位置、各个网段。存储系统作为CDN系统密不可分的一部分，将CDN分发的文件和数据库表记录内容存储起来，提供持续服务。存储系统采用三级存储架构，包括核心存储、CDN服务节点分布式缓存和终端本地缓存。任意一个点的存储崩溃或失效，并不影响系统服务的可用性。

　　如CDN系统在5大运营商（中国电信、中国网通、中国铁通、中国移动、中国联通）以及2大专有网络（中国教育和科研计算机网、中国科技网）都布有CDN节点。这样就消除了不同运营商之间互联的瓶颈造成的影响，实现了跨运营商的网络加速，保证不同网络中的用户都能得到良好的访问质量。

### 内容管理
　　内容管理和全局的网络流量管理(TrafficManagement)是CDN的核心所在。通过用户就近性和服务器负载的判断，CDN确保内容以一种极为高效的方式为用户的请求提供服务。总的来说，内容服务基于缓存服务器，也称作代理缓存(Surrogate)，它位于网络的边缘，距用户仅有"一跳"(SingleHop)之遥。同时，代理缓存是内容提供商源服务器（通常位于CDN服务提供商的数据中心）的一个透明镜像。这样的架构使得CDN服务提供商能够代表他们客户，即内容供应商，向最终用户提供尽可能好的体验，而这些用户是不能容忍请求响应时间有任何延迟的。据统计，采用CDN技术，能处理整个网站页面的 70%～95％的内容访问量，减轻服务器的压力，提升了网站的性能和可扩展性。

### 负载均衡
　　CDN负载均衡系统实现CDN的内容路由功能。它的作用是将用户的请求导向整个CDN网络中的最佳节点。最佳节点的选定可以根据多种策略，例如距离最近、节点负载最轻等。负载均衡系统是整个CDN的核心，负载均衡的准确性和效率直接决定了整个CDN的效率和性能。通常负载均衡可以分为两个层次：全局负载均衡（GSLB）和本地负载均衡（SLB）。

　　全局负载均衡（GSLB）主要的目的是在整个网络范围内将用户的请求定向到最近的节点（或者区域）。因此，就近性判断是全局负载均衡的主要功能。

　　本地负载均衡一般局限于一定的区域范围内，其目标是在特定的区域范围内寻找一台最适合的节点提供服务，因此，CDN节点的健康性、负载情况、支持的媒体格式等运行状态是本地负载均衡进行决策的主要依据。
    
　　负载均衡可以通过多种方法实现，主要的方法包括DNS、应用层重定向、传输层重定向等等。对于全局负载均衡而言，为了执行就近性判断，通常可以采用两种方式，一种是静态的配置，例如根据静态的IP地址配置表进行IP地址到CDN节点的映射。另一种方式是动态的检测，例如实时地让CDN节点探测到目标IP的距离（可以采用RRT，Hops作为度量单位），然后比较探测结果进行负载均衡。当然，静态和动态的方式也可以综合起来使用。
    
　　对于本地负载均衡而言，为了执行有效的决策，需要实时地获取Cache设备的运行状态。获取的方法一般有两种，一种是主动探测，一种是协议交互。主动探测针对SLB设备和Cache设备没有协议交互接口的情况，通过ping等命令主动发起探测，根据返回结果分析状态。另一种是协议交互，即SLB和 Cache根据事先定义好的协议实时交换运行状态信息，以便进行负载均衡。比较而言，协议交互比探测方式要准确可靠，但是目前尚没有标准的协议，各厂家的实现一般仅是私有协议，互通比较困难。

### 网络请求的重定向
　　当用户访问了使用CDN服务的资源时，DNS域名服务器通过CNAME方式将最终域名请求重定向到CDN系统中的智能DNS负载均衡系统。智能DNS负载均衡系统通过一组预先定义好的策略（如内容类型、地理区域、网络负载状况等），将当时能够最快响应用户的节点地址提供给用户，使用户可以得到快速的服务。
    
　　同时，它还与分布在不同地点的所有CDN节点保持通信，搜集各节点的健康状态，确保不将用户的请求分配到任何一个已经不可用的节点上。

---

## 资源访问流程

![](http://www.chinaspeeds.com/imgs/cdn_242343.jpg)

* 用户向浏览器提供要访问网站的域名，域名解析的请求被发往网站的DNS域名解析服务器；
* 由于网站的DNS域名解析服务器对此域名的解析设置了CNAME，请求被指向CDN网络中的智能DNS负载均衡系统；
* 智能DNS负载均衡系统对域名进行智能解析，将响应速度最快的节点IP返回给用户；
* 浏览器在得到速度最快节点的IP地址以后，向CDN节点发出访问请求；
* 由于是第一次访问，CDN节点将回到源站取用户请求的数据并发给用户；
* 当有其他用户再次访问同样内容时，CDN将直接将数据返回给客户，完成请求/服务过程。

---

## 引用

> [CDN - Wikipedia](https://en.wikipedia.org/wiki/Content_delivery_network)

> [CDN-内容推送网络](http://www.cnblogs.com/skynet/archive/2012/12/18/2824141.html)
